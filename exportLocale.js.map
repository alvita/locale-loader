{"version":3,"sources":["exportLocale.js"],"names":["rawData","sourceLocale","supportedLocales","sourceFolder","localizationFolder","exportType","xlfData","allLocales","filter","locale","forEach","_declaration","_attributes","version","xliff","xmlns","folderPath","folderData","sourceFile","files","keys","data","targetFile","fileName","file","original","relative","join","path","exportKeys","full","slice","key","length","datatype","body","map","id","template","isTemplate","source","_text","value","target","push","exists","all","resolve","writeFile","json2xml","compact","spaces","exportXlf","diff","exportLocale"],"mappings":"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","file":"exportLocale.js","sourcesContent":["import fs from 'fs-promise';\nimport path from 'path';\nimport xml from 'xml-js';\nimport mkdirp from 'mkdirp-promise';\nimport getRawData from './getRawData';\nimport {\n  defaultSupportedLocales,\n  defaultSourceLocale,\n  defaultSourceFolder,\n  defaultLocalizationFolder,\n} from './defaults';\nimport exportTypes from './exportTypes';\n\nexport async function exportXlf({\n  rawData,\n  sourceLocale,\n  supportedLocales,\n  sourceFolder,\n  localizationFolder,\n  exportType,\n}) {\n  // console.log(JSON.stringify(rawData, null, 2));\n  const xlfData = {};\n  const allLocales = supportedLocales.filter(locale => locale !== sourceLocale);\n\n  allLocales.forEach((locale) => {\n    xlfData[locale] = {\n      _declaration: {\n        _attributes: {\n          version: '1.0',\n        }\n      },\n      xliff: {\n        _attributes: {\n          version: '1.2',\n          xmlns: 'urn:oasis:names:tc:xliff:document:1.2',\n        },\n      },\n    };\n  });\n\n  Object.keys(rawData).forEach((folderPath) => {\n    const folderData = rawData[folderPath];\n    const sourceFile = folderData.files[sourceLocale];\n    if (sourceFile) {\n      const keys = Object.keys(sourceFile.data);\n      supportedLocales.forEach((locale) => {\n        if (locale !== sourceLocale) {\n          const targetFile = folderData.files[locale];\n          const fileName = (targetFile && targetFile.file) || `${locale}.js`;\n          const original = path.relative(\n            sourceFolder,\n            path.join(folderData.path, fileName),\n          );\n          const exportKeys = exportType === exportTypes.full ?\n            keys.slice() :\n            keys.filter(key => (!targetFile || !targetFile.data[key]));\n\n          if (exportKeys.length) {\n            const data = {\n              _attributes: {\n                original,\n                'source-language': sourceLocale,\n                'target-language': locale,\n                datatype: 'plaintext',\n              },\n              body: {\n                'trans-unit': exportKeys.map(key => ({\n                  _attributes: {\n                    id: `[${key}]`,\n                    template: sourceFile.data[key].isTemplate ? 'true' : 'false',\n                  },\n                  source: {\n                    _text: sourceFile.data[key].value,\n                  },\n                  target: {\n                    _text: (targetFile && targetFile.data[key] && targetFile.data[key].value) ||\n                    sourceFile.data[key].value,\n                  },\n                })),\n              },\n            };\n\n            if (!xlfData[locale].xliff.file) {\n              xlfData[locale].xliff.file = [];\n            }\n            xlfData[locale].xliff.file.push(data);\n          }\n        }\n      });\n    }\n  });\n  if (!(await fs.exists(localizationFolder))) {\n    await mkdirp(localizationFolder);\n  }\n  await Promise.all(allLocales.map(async (locale) => {\n    const fileName = path.resolve(localizationFolder, `${locale}.xlf`);\n    await fs.writeFile(fileName, xml.json2xml(xlfData[locale], { compact: true, spaces: 4 }));\n  }));\n}\n\nasync function exportLocale({\n  sourceFolder = defaultSourceFolder,\n  localizationFolder = defaultLocalizationFolder,\n  sourceLocale = defaultSourceLocale,\n  supportedLocales = defaultSupportedLocales,\n  exportType = exportTypes.diff,\n} = {}) {\n  const rawData = await getRawData({\n    sourceFolder,\n    sourceLocale,\n    supportedLocales,\n  });\n  await exportXlf({\n    rawData,\n    sourceFolder,\n    localizationFolder,\n    sourceLocale,\n    supportedLocales,\n    exportType,\n  });\n}\n\nexport default exportLocale;\n"]}